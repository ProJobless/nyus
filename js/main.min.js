/*!
*
* Copyright (c) David Bushell | http://dbushell.com/
*
*/function findIgnores(){var e=$("a");$ignoreMe=e.filter(function(e){return $(this).attr("rel")==="ignore"});return $ignoreMe}function getDocHeight(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function infiniteScroll(){var e=$(window),t=function(){e.scrollTop()+e.height()>getDocHeight()-100;setTimeout(t,500)};setTimeout(t,500)}(function(e,t,n){var r=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},i=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},s=function(e,t){i(e,t)||(e.className=e.className===""?t:e.className+" "+t)},o=function(e,t){e.className=r((" "+e.className+" ").replace(" "+t+" "," "))},u=function(e,t){if(e)do{if(e.id===t)return!0;if(e.nodeType===9)break}while(e=e.parentNode);return!1},a=t.documentElement,f=e.Modernizr.prefixed("transform"),l=e.Modernizr.prefixed("transition"),c=function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"};return e.hasOwnProperty(l)?e[l]:!1}();e.App=function(){var n=!1,r={},f=t.getElementById("page"),h=!1,p="js-nav";r.init=function(){if(n)return;n=!0;var d=function(e){e&&e.target===f&&t.removeEventListener(c,d,!1);h=!1};r.closeNav=function(){if(h){var n=c&&l?parseFloat(e.getComputedStyle(f,"")[l+"Duration"]):0;n>0?t.addEventListener(c,d,!1):d(null)}o(a,p)};r.openNav=function(){if(h)return;s(a,p);h=!0};r.toggleNav=function(e){h&&i(a,p)?r.closeNav():r.openNav();e&&e.preventDefault()};try{t.getElementById("menu-btn").addEventListener("click",r.toggleNav,!1)}catch(v){}t.addEventListener("click",function(e){if(h&&!u(e.target,"nav")){e.preventDefault();r.closeNav()}},!0);s(a,"js-ready")};return r}();e.addEventListener&&e.addEventListener("DOMContentLoaded",e.App.init,!1)})(window,window.document);if(!!window.console){function c(e){console.log(e)}function d(e){console.dir(e)}}(function(){var e=document.createElement("canvas"),t=document.getElementById("form"),n=$("<button/>").attr({"class":"clear",id:"clear",type:"button"}).html("Clear"),r=$("<span/>").addClass("size").attr("id","size"),i=$("<span/>").addClass("filename").attr("id","filename"),s=$("input[type=hidden], canvas"),o=$("#preview"),u=$("#profile-select"),a=[],f={},l=Math.PI/180,c=0,h,p;window.URL=window.URL||window.webkitURL;$modernPhotoInput=$(".filereader .photo-input");$modernPhotoInput.change(function(e){disabler(this);var t=this.files[0];this.name==="photo_filename"&&(!o.find("img").length||(h=o.find("img").detach()));modernProcessor(this.files)});outdatedProcessor=function(e){var t=e[0],s=new FileReader;if(!sizeCheck(t))return!1;r.text(p).prependTo(".specs");i.text(t.name+": ").prependTo(".specs");o.append(n);if(t.type.match("image")){var u=new Image;s.onload=function(e){f.data=e.target.result;u.src=e.target.result};u.onload=function(){updatePreview(this)};s.onloadend=function(){prepInputs(t)}}else{s.onload=function(e){updatePreview();f.data=e.target.result};s.onloadend=function(){prepInputs(t)}}s.readAsDataURL(t)};modernProcessor=function(e){var t=e[0],s=new FileReader;if(!sizeCheck(t))return!1;r.text(p).prependTo(".specs");i.text(t.name+": ").prependTo(".specs");o.append(n);if(t.type.match("image")){var u=new Image;s.onload=function(e){u.src=e.target.result};u.onload=function(){updatePreview(this)}}else s.onload=function(e){updatePreview()};s.readAsDataURL(t)};updatePreview=function(e){o.find(".thumb").prepend(e);!$(".full-profile").length||n.html("Revert");o.addClass("loaded");u.toggleClass("visuallyhidden")};getSize=function(e){var t=e,n=t+" bytes";for(var r=["KB","MB"],i=0,s=t/1024;s>1;s/=1024,i++)n=s.toFixed(2)+" "+r[i];return n};sizeCheck=function(e){var t,n,i,s;p=getSize(e.size);if(e.type.match("image")){n=25e5;i="2.5 MB";s="images"}else if(e.type.match("audio")){n=5e6;i="5 MB";s="audio clips"}else{if(!e.type.match("video")){alert("Only image, video, and audio file types are allowed.");return!1}n=15e6;i="15 MB";s="videos"}if(e.size>n){readableLimit=getSize(n);fileClear();r.text("Sorry, but the maximum file size for "+s+" is "+readableLimit+". "+e.name+" is "+p).prependTo(".specs");return!1}return!0};fileClear=function(){o.find("img, #size, #filename").remove();!a||$(a).remove();h?o.append(h):o.removeClass("loaded");!$("canvas").length||$("canvas").remove();!$("#profile-input").length||($("#profile-input")[0].flag=!1);var e=$("input[type=file]");e.val("").prop("disabled",!1);e.parent().removeClass("disabled");u.toggleClass("visuallyhidden")};imageCheck=function(e){var t,n=25e5,i="2.5 MB";p=getSize(e.size);if(e.size>n){t=getSize(n);fileClear();r.text("Sorry, but the maximum file size for images is "+t+". "+e.name+" is "+p).prependTo(".specs");return!1}return!0};videoHandler=function(e){var t,s=15e6,u="15 MB";p=getSize(e.size);if(e.size>s){t=getSize(s);fileClear();r.text("Sorry, but the maximum file size for videos is "+t+". "+e.name+" is "+p).prependTo(".specs");return!1}r.text(p).prependTo(".specs");i.text(e.name+": ").prependTo(".specs");o.append(n)};audioHandler=function(e){var t,s=5e6,u="5 MB";p=getSize(e.size);if(e.size>s){t=getSize(s);fileClear();r.text("Sorry, but the maximum file size for audio clips is "+t+". "+e.name+" is "+p).prependTo(".specs");return!1}r.text(p).prependTo(".specs");i.text(e.name+": ").prependTo(".specs");o.append(n)};disabler=function(e){if(!!$(".upload-buttons").length){$notSelected=$("input[type=file]").not(e);$notSelected.parent().addClass("disabled");$notSelected.prop("disabled",!0)}};$unsupported=$(".no-filereader input[type=file]");$unsupported.removeClass("visuallyhidden");$unsupported.change(function(e){});prepInputs=function(e){a=[];for(var n=["audio","image","video"],r=0,i;r<n.length;r++)if(e.type.match(n[r])){i=n[r];break}for(prop in f){var s=document.createElement("input");if(f.hasOwnProperty(prop)){s.type="hidden";s.name=i+"["+prop+"]";s.value=f[prop];t.appendChild(s);a.push(s)}}return a};Modernizr.load([{test:Modernizr.formvalidation,nope:"/introductions/js/vendor/validate.min.js",complete:function(){if(!Modernizr.formvalidation){validator=new FormValidator("new-post",[{name:"friends_status",display:"Post",rules:"required"}],function(e,t){$form=$(this.form);if(e.length===0){$form.find("input[type=submit]").prop("disabled","true");$form.find("input[type=submit]").before('<span class="loading" />')}else if(!$(".required").length){$form.prepend('<div class="required" />');$(".required").html("Please include a message and try submitting again.")}});setupValidator=new FormValidator("setup-form",[{name:"photo_filename",display:"Photo",rules:"required"},{name:"location",display:"Hometown",rules:"required"},{name:"occupation",display:"Current City",rules:"required"},{name:"interests",display:"Interests",rules:"required"}],function(e,t){$form=$(this.form);e.length>0&&$.fancybox($requiredMessage)})}}},{test:Modernizr.filereader,nope:["/introductions/js/vendor/jquery-ui/jquery-ui-position.js","/introductions/js/vendor/filereader/jquery.FileReader.js","/introductions/js/vendor/swfobject/swfobject.js"],complete:function(){if(!Modernizr.filereader&&!$(".setup").length){$("input[type=file]").fileReader({id:"fileReaderSWF",filereader:"/introductions/js/vendor/filereader/filereader.swf",expressInstall:"/introductions/js/vendor/swfobject/expressInstall.swf",debugMode:!1,callback:function(){}});$("input[type=file]").change(function(e){disabler(this);window.evt=e;var t=e.target.files;f.name=t[0].name;f.type=t[0].type;outdatedProcessor(t)})}}}])})();$(document).ready(function(){if(!!$(".setup").length){var e="",n=["all","questions","actions","yours","students","profile"];for(var r=0;r<n.length;r++)r===n.length-1?e+="#nav-"+n[r]:e+="#nav-"+n[r]+", ";$disable=$(".setup").find(e);$disable.addClass("disable").attr("rel","ignore")}$("body").one("click","#terms-content",function(){window.open(this.href,"_blank")});$("#back-to-one").click(function(){window.location="https://shanghai.nyu.edu/introductions/setup/step-one"});$("#edit-details").click(function(e){e.preventDefault();if(!$("#instructions").length){if(!!$("#info").length){$("#profile-form, #info").toggleClass("visuallyhidden");$("#clear").length||$("#profile-select").toggleClass("visuallyhidden")}}else{$("#fields, #instructions").toggleClass("visuallyhidden");$("#clear").length||$("#profile-select").toggleClass("visuallyhidden");$("#next").prop("disabled",!1)}$(this).toggleClass("open")});var i={title:{},closeClick:!0,overlay:{css:{background:"black"}}};$(".posted-img").fancybox({helpers:i});$(".posted-audio, .posted-video").click(function(e){e.preventDefault();path=$(this).attr("data-path");audio=$(this).attr("data-audio");width=window.innerWidth;$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"path="+path+"&audio="+audio+"&width="+width},helpers:i})});$("body").on("click",".fancybox-overlay .posted-audio, .fancybox-overlay .posted-video",function(e){e.preventDefault();$.fancybox.close();path=$(this).attr("data-path");audio=$(this).attr("data-audio");width=window.innerWidth;$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"path="+path+"&audio="+audio+"&width="+width},helpers:i})});$("#notifications a.notification").click(function(e){e.preventDefault();memberId=$(this).attr("data-member");statusToLoad=$(this).attr("data-related-status");$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"memberid="+memberId+"&status="+statusToLoad},helpers:i})});$(".notifications-page a").click(function(e){e.preventDefault();memberId=$(this).attr("data-member");statusToLoad=$(this).attr("data-related-status");$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"memberid="+memberId+"&status="+statusToLoad},helpers:i})});$("#notifications-icon").click(function(){$(".notifications-count").addClass("viewed");var e=new Date;$.cookie("last_viewed_notifications",e.getTime(),{expires:365,path:"/"})});$("#actions-icon").click(function(){var e=new Date;$.cookie("last_viewed_actions",e.getTime(),{expires:365,path:"/"})});$("#notifications-icon, #actions-icon, .attach-media, #profile-select").click(function(e){e.preventDefault()});findIgnores();$ignoreMe.on("click",function(e){e.preventDefault()});$(".no-csstransforms3d #menu-btn").click(function(e){e.preventDefault();$("#nav").toggleClass("open")});if(!Modernizr.mq("only all")){$(".post-icon").addClass("visuallyhidden");if(!!$(".step-one").length&&!!$.cookie("terms")){menu=document.getElementById("menu-btn");navReveal=function(){menu.click()};window.setTimeout(navReveal,250)}}$(".comment-form").submit(function(e){t=new Date;$(this).find("input[name=comment_date]").val(t.getTime())});$(".filereader .attach-media, .filereader #profile-select").click(function(){$(this).siblings("input").click()});$(".filereader #video-input").change(function(e){disabler(this);videoHandler(this.files[0])});$(".filereader #audio-input").change(function(e){disabler(this);audioHandler(this.files[0])});$("#preview").on("click","#clear",function(e){try{fileClear(oldPhoto)}catch(e){fileClear()}$(this).detach()});$requiredMessage=$("<p>Please fill out all fields and choose a profile photo</p>").addClass("required");$(".formvalidation form").submit(function(e){$this=$(this);if(!this.checkValidity()){(this.id="setup-form")&&$.fancybox($requiredMessage);return!1}$this.find("input[type=submit]").prop("disabled","true");$this.find("input[type=submit]").before('<span class="loading" />')})});