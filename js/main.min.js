/*!
*
* Copyright (c) David Bushell | http://dbushell.com/
*
*/function findIgnores(){var e=$("a");$ignoreMe=e.filter(function(e){return $(this).attr("rel")==="ignore"});return $ignoreMe}function getDocHeight(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function infiniteScroll(){var e=$(window),t=function(){e.scrollTop()+e.height()>getDocHeight()-100;setTimeout(t,500)};setTimeout(t,500)}function checkFileSize(e){var t,n,r,i=/image.*/,s=/video.*/,o=/audio.*/;if(e.type.match(i)){n=25e5;r="2.5 MB";input=document.getElementById("photo-input")}else if(e.type.match(o)){n=1e7;r="10 MB";input=document.getElementById("audio-input")}else{n=15e6;r="15 MB";input=document.getElementById("video-input")}if(e.size>n){try{$("#size").html("Too Big! Choose another file");$("#submit").prop("disabled",!0)}catch(u){}return}$("#submit").prop("disabled",!1);return t}(function(e,t,n){var r=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},i=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},s=function(e,t){i(e,t)||(e.className=e.className===""?t:e.className+" "+t)},o=function(e,t){e.className=r((" "+e.className+" ").replace(" "+t+" "," "))},u=function(e,t){if(e)do{if(e.id===t)return!0;if(e.nodeType===9)break}while(e=e.parentNode);return!1},a=t.documentElement,f=e.Modernizr.prefixed("transform"),l=e.Modernizr.prefixed("transition"),c=function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"};return e.hasOwnProperty(l)?e[l]:!1}();e.App=function(){var n=!1,r={},f=t.getElementById("page"),h=!1,p="js-nav";r.init=function(){if(n)return;n=!0;var d=function(e){e&&e.target===f&&t.removeEventListener(c,d,!1);h=!1};r.closeNav=function(){if(h){var n=c&&l?parseFloat(e.getComputedStyle(f,"")[l+"Duration"]):0;n>0?t.addEventListener(c,d,!1):d(null)}o(a,p)};r.openNav=function(){if(h)return;s(a,p);h=!0};r.toggleNav=function(e){h&&i(a,p)?r.closeNav():r.openNav();e&&e.preventDefault()};try{t.getElementById("menu-btn").addEventListener("click",r.toggleNav,!1)}catch(v){}t.addEventListener("click",function(e){if(h&&!u(e.target,"nav")){e.preventDefault();r.closeNav()}},!0);s(a,"js-ready")};return r}();e.addEventListener&&e.addEventListener("DOMContentLoaded",e.App.init,!1)})(window,window.document);if(!!window.console){function c(e){console.log(e)}function d(e){console.dir(e)}}(function(){function d(t,n){var r=$fileinput.data("maxwidth"),i=$fileinput.data("maxheight"),s=t.width,o=t.height,u,a;if(s>o){if(s>r){a=Math.round(o*=r/s);u=r}}else if(o>i){u=Math.round(s*=i/o);a=i}e.width=u;e.height=a;ctx=e.getContext("2d");ctx.drawImage(t,0,0,u,a);return e.toDataURL(n,.7)}function v(e,t){var n=e.files;!$("canvas").length||$("canvas").remove();for(var r=0;r<n.length;r++)c=m(n[r],t);t.name!="photo_filename"&&(e.value="");if(!!$(".upload-buttons").length){$notSelected=$("input[type=file]").not(t);$notSelected.parent().addClass("disabled");$notSelected.prop("disabled",!0)}$(t).hasClass("photo-input")&&$("#profile-select").toggleClass("visuallyhidden");return c}function m(e,t){l.name=e.name;l.type=e.type;if(t.className.match("photo")&&!!s.find("img").length)var r=s.find("img").detach();var i=new FileReader;i.readAsArrayBuffer(e);i.onload=function(e){var r=new Blob([e.target.result],{type:l.type});window.URL=window.URL||window.webkitURL;var i=window.URL.createObjectURL(r);image.src=i;window.URL.revokeObjectURL(i);image.onload=function(){l.image=d(this,l.type);s.prepend(this).append(n);if(t.name!="photo_filename")try{window.oldInputs=prepInputs(u)}catch(e){window.oldInputs=prepInputs()}}};return r}var e=document.createElement("canvas"),t=document.getElementById("form"),n=$("<button/>").attr({"class":"clear",id:"clear",type:"button"}).html("Clear"),r=$("<span/>").addClass("size").attr("id","size"),i=$("input[type=hidden], canvas"),s=$("#preview"),o=$("#profile-select"),u=[],a=Math.PI/180,f=0,l={},u,c,h;window.URL=window.URL||window.webkitURL;try{$fileinput=$(".filereader .photo-input");$fileinput.change(function(e){var t=this.files[0];l.type=t.type;l.name=t.name;l.type=t.type;this.name==="photo_filename"&&(!s.find("img").length||(c=s.find("img").detach()));!$(".step-one").length&&!$(".profile").length?postImages(t,1e3,1e3,.7,l.type):profileImages(this.files)})}catch(p){}postImages=function(e,t,n,r,i){var s=new FileReader,o=document.createElement("canvas"),u=null,a=new Image,f=null;o.id="hiddenCanvas";o.style.visibility="hidden";document.body.appendChild(o);u=o.getContext("2d");e.type.match("image.*")?s.readAsDataURL(e):alert("File is not an image");s.onload=function(){var e=this.result;a.src=e};s.onabort=function(){alert("The upload was aborted.")};s.onerror=function(){alert("An error occured while reading the file.")};a.onload=function(){if(this.width==0||this.height==0)alert("Image is empty");else{var e=this.width,s=this.height,c,p;if(e>s)if(e>t){p=Math.round(s*=t/e);c=t}else{p=s;c=e}else if(s>n){c=Math.round(e*=n/s);p=n}else{p=s;c=e}o.width=c;o.height=p;u.clearRect(0,0,c,p);u.drawImage(a,0,0,this.width,this.height,0,0,c,p);f=dataURItoBlob(o.toDataURL(i,r));h=getSize(f);l.image=o.toDataURL(i,r);updatePreview(this);prepInputs()}};a.onabort=function(){alert("Image load was aborted.")};a.onerror=function(){alert("An error occured while loading image.")}};prepInputs=function(){!u||$(u).remove();for(prop in l){var e=document.createElement("input");if(l.hasOwnProperty(prop)){e.type="hidden";e.name="images["+prop+"]";e.value=l[prop];t.appendChild(e);u.push(e)}}$fileinput[0].value="";return u};dataURItoBlob=function(e){var t=";base64,";if(e.indexOf(t)==-1){var n=e.split(","),r=n[0].split(":")[1],i=n[1];return new Blob([i],{type:r})}var n=e.split(t),r=n[0].split(":")[1],i=window.atob(n[1]),s=i.length,o=new Uint8Array(s);for(var u=0;u<s;++u)o[u]=i.charCodeAt(u);return new Blob([o],{type:r})};profileImages=function(e){var t=e[0],n=new FileReader,r=new Image;n.onload=function(e){r.onload=function(){updatePreview(this)};r.src=e.target.result;h=getSize(t)};n.readAsDataURL(t)};blobReader=function(e){var t=e[0],n=new FileReader,r=new Image;n.onload=function(e){var n=new Int8Array(e.target.result),i=new Blob([n],{type:"image/png"}),s=window.URL.createObjectURL(i)||window.webkitURL.createObjectURL(i);r.onload=updatePreview;r.src=s;h=getSize(t);$fileinput[0].files[0]=i};n.readAsArrayBuffer(t)};updatePreview=function(e){s.find(".thumb").prepend(e);!$(".full-profile").length||n.html("Revert");s.find(".specs").append(n);r.text(h).prependTo(".specs");s.addClass("loaded");o.toggleClass("visuallyhidden")};getSize=function(e){var t=e.size,n=t+" bytes";for(var r=["KB","MB"],i=0,s=t/1024;s>1;s/=1024,i++)n=s.toFixed(2)+" "+r[i];return n};fileClear=function(){s.find("img, #size").remove();!u||$(u).remove();c?s.append(c):s.removeClass("loaded");!$("canvas").length||$("canvas").remove();!$("#profile-input").length||($("#profile-input")[0].flag=!1);var e=$("input[type=file]");e.val("").prop("disabled",!1);e.parent().removeClass("disabled");o.toggleClass("visuallyhidden")};window.rotate=function(t){if(t==="left"){f===0&&(f=360);f-=90}else if(t==="right"){f===360&&(f=0);f+=90}var n=e.width,r=e.height,i=0,s=0;switch(f){case 0:n=e.width;r=e.height;iw=e.width;ih=e.height;break;case 90:n=e.height;r=e.width;s=e.height*-1;iw=r;ih=n;break;case 180:i=e.width*-1;s=e.height*-1;break;case 270:n=e.height;r=e.width;i=e.height*-1}ctx.clearRect(0,0,e.width,e.height);e.width=n;e.height=r;ctx.rotate(f*a);ctx.drawImage(image,i,s,iw,ih);$("#thumb img").attr("class","rotate"+f);u&&$(u).remove();l.image=e.toDataURL(l.type,1);try{window.oldInputs=prepInputs(u)}catch(o){window.oldInputs=prepInputs()}}})();$(document).ready(function(){infiniteScroll();if(!!$(".setup").length){var e="",t=["all","questions","actions","yours","students","profile"];for(var n=0;n<t.length;n++)n===t.length-1?e+="#nav-"+t[n]:e+="#nav-"+t[n]+", ";$disable=$(".setup").find($(e));$disable.addClass("disable").attr("rel","ignore")}if(!!$(".step-one").length&&!!$.cookie("terms")){menu=document.getElementById("menu-btn");navReveal=function(){menu.click()};window.setTimeout(navReveal,250);var r=$("input[type=text], textarea, #profile-input"),i=$("<p>Please fill out all fields and choose a profile photo</p>").addClass("required");$("#form").attr("novalidate",!0);r.each(function(){this.value?this.flag=!0:this.flag=!1});r.change(function(){!this.value||(this.flag=!0)});$(".step-one").on("submit",function(e){for(var t=0;t<r.length-1;t++){if(r[t].flag)continue;$.fancybox(i);!window.console||console.log("Not so fast hax0r. Fill out all fields first.");return!1}})}$("#edit-details").click(function(e){e.preventDefault();if(!$("#instructions").length){if(!!$("#info").length){$("#form, #info").toggleClass("visuallyhidden");$("#clear").length||$(".filereader #profile-select").toggleClass("visuallyhidden")}}else{$("#fields, #instructions").toggleClass("visuallyhidden");$("#clear").length||$(".filereader #profile-select").toggleClass("visuallyhidden");$("#next").prop("disabled",!1)}$(this).toggleClass("open")});$("#preview").on("click","#clear",function(e){try{fileClear(oldPhoto)}catch(e){fileClear()}$(this).detach()});$(".filereader .attach-media, .filereader #profile-select").click(function(){$(this).siblings("input").click()});$(".no-filereader input[type=file]").removeClass("visuallyhidden");$("input[type=file]").change(function(){if(!!$(".upload-buttons").length){$notSelected=$("input[type=file]").not(this);$notSelected.parent().addClass("disabled");$notSelected.prop("disabled",!0)}});try{!!document.URL.match(/setup/).length}catch(s){}var o={title:{},closeClick:!0,overlay:{css:{background:"black"}}};$(".posted-img").fancybox({helpers:o});$(".posted-audio, .posted-video").click(function(e){e.preventDefault();path=$(this).attr("data-path");audio=$(this).attr("data-audio");width=window.innerWidth;$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"path="+path+"&audio="+audio+"&width="+width},helpers:o})});$("#notifications a").click(function(e){e.preventDefault();memberId=$(this).attr("data-member");statusToLoad=$(this).attr("data-related-status");$.fancybox(this,{type:"ajax",ajax:{type:"POST",data:"memberid="+memberId+"&status="+statusToLoad},helpers:o})});if(!!$(".step-one").length&&$.cookie("terms")===undefined){$.fancybox.open({href:"../includes/accept-terms",type:"ajax",ajax:{method:"POST"}},{minHeight:65,minWidth:250,modal:!0,padding:[35,15,15,15]});$("body").one("click","#terms-content",function(){window.open(this.href,"_blank")})}$("body").on("submit","#terms",function(e){$.cookie("terms","accepted",{expires:365,path:"/"})});$("#notifications-icon").click(function(){$(".notifications-count").addClass("viewed");var e=new Date;$.cookie("last_viewed_notifications",e.getTime(),{expires:365,path:"/"})});$("#actions-icon").click(function(){$(".actions-count").addClass("viewed");var e=new Date;$.cookie("last_view_actions",e.getTime(),{expires:365,path:"/"})});$("#notifications-icon, #actions-icon, .attach-media, #profile-select").click(function(e){e.preventDefault()});findIgnores();$ignoreMe.on("click",function(e){e.preventDefault()});$(".no-csstransforms3d #menu-btn").click(function(e){e.preventDefault();$("#nav").toggleClass("open")});Modernizr.mq("all")||$(".post-icon").addClass("visuallyhidden")});